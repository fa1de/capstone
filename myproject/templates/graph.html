<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- chartjs-plugin-datalabels 플러그인 추가 -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <link rel="stylesheet" href="/static/ex.css" type="text/css">
</head>
<body>      
    <div id= "top"></div>
    
        <button type="button" id="button" > <img src="../static/start.png" width="50px" height="50px" /></button>
    
        <select id="option">
            <option value="none">인터페이스 선택</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
        </select>

        <input type="button" value="Start" id="start" ></button>
    

    <div id="chart-container">
        <canvas id="myLineChart"></canvas>
        <canvas id="myBarChart"></canvas>
    </div>

    <div id= "line" style="border: 2px solid;"></div>

    <script>
        // chartjs-plugin-datalabels 플러그인을 등록합니다.
        Chart.register(ChartDataLabels);
        
        var ctxLine = document.getElementById('myLineChart').getContext('2d');
        var myLineChart = new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: ['TCP', 'UDP', 'ICMP', 'HTTP', 'FTP', 'DNS', 'SSH'],
                datasets: [{
                    label: 'Protocol Count',
                    data: [0, 0, 0, 0, 0, 0, 0], // 초기 카운트를 0으로 설정합니다.
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        color: 'red',
                        formatter: function(value, context) {
                            return value;
                        },
                        align: 'end',
                        anchor: 'end',
                        font: {
                            weight: 'bold'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    
        function updateChart() {
            fetch('/packet/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    protocol_name: document.getElementById('option').value // 프로토콜 선택 옵션에서 값을 가져와서 전송
                })
            })
            .then(response => response.json())
            .then(protocolCounts => {
                console.log('Protocol counts:', protocolCounts);
        
                // 프로토콜별 카운트를 저장할 객체 초기화
                const countMap = {
                    'TCP': 0,
                    'UDP': 0,
                    'ICMP': 0,
                    'HTTP': 0,
                    'FTP': 0,
                    'DNS': 0,
                    'SSH': 0
                };
        
                    for (const key in protocolCounts) {
                        if (Object.hasOwnProperty.call(protocolCounts, key)) {
                            const item = protocolCounts[key];
                            const protocolName = item.protocol_name;
                            if (typeof protocolName === 'string') { // 문자열인 경우에만 처리
                                if (countMap.hasOwnProperty(protocolName)) {
                                    // 해당하는 프로토콜의 카운트 값을 서버로부터 받아온 값으로 업데이트
                                    countMap[protocolName] = item.count;
                                }
                            }
                        }
                    }
        
                    // 카운트 값 배열 초기화
                    const counts = Object.values(countMap);
        
                    // 그래프 업데이트
                    myLineChart.data.datasets[0].data = counts;
                    myLineChart.update();
                })
                .catch(error => console.error('Error fetching data:', error));
        }
    
        // 초기 그래프 업데이트 호출
        updateChart();
    
        // 주기적으로 그래프 업데이트
        setInterval(updateChart, 3000);
    </script>
    
    

    <div id= "bar" style="border: 2px solid;"></div>

    <script>
        var ctxBar = document.getElementById('myBarChart').getContext('2d');
        var myBarChart = new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: 'Sample Data',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        color: 'red',
                        align: 'end',
                        anchor: 'end',
                        font: {
                            weight: 'bold'
                        }
                    }
                }
            }
        });
    </script>

    <div id= "list1" style="border: 2px solid;"></div>
    <hr id="line1" style="border: solid 1px; "/>
    <b id="list1_text">
        Regex Matching Packet
    </b>

     <!-- 새로운 패킷 정보 칸 추가 -->
     <div id="list2" style="border: 2px solid; margin-top: 10px;"></div>
     <hr id="line2" style="border: solid 1px;"/>
     <b id="list2_text">Blacklist IP</b>
    
    

</body>


    </html>